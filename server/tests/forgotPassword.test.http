### ==================== FORGOT PASSWORD TESTING ====================
### Test complete forgot password flow with email verification

@baseUrl = http://localhost:5000/api

### ==================== 1. SEND VERIFICATION CODE ====================
### Send verification code to email
# @name send_code
POST {{baseUrl}}/auth/forgot-password
Content-Type: application/json

{
  "email": "staff2@mini.vn"
}

### Expected Response:
### {
###   "success": true,
###   "message": "Mã xác thực đã được gửi đến email của bạn",
###   "data": {
###     "email": "staff2@mini.vn",
###     "expiresIn": "10 minutes"
###   }
### }

### Check your email inbox for the 6-digit verification code

### ==================== 2. VERIFY CODE AND RESET PASSWORD ====================
### Verify the code and set new password
# @name verify_code
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "staff2@mini.vn",
  "code": "123456",
  "newPassword": "NewPassword123!"
}

### Expected Response:
### {
###   "success": true,
###   "message": "Mật khẩu đã được đặt lại thành công..."
### }

### ==================== 3. RESEND VERIFICATION CODE ====================
### If user didn't receive code or it expired
# @name resend_code
POST {{baseUrl}}/auth/resend-verification-code
Content-Type: application/json

{
  "email": "staff2@mini.vn"
}

### Expected Response:
### {
###   "success": true,
###   "message": "Mã xác thực mới đã được gửi đến email của bạn"
### }

### ==================== 4. LOGIN WITH NEW PASSWORD ====================
### Test login with the new password
# @name login_new_password
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "staff2",
  "password": "NewPassword123!"
}

### ==================== NEGATIVE TESTS ====================

### Test: Wrong verification code
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "staff2@mini.vn",
  "code": "999999",
  "newPassword": "NewPassword123!"
}

### Test: Expired code (wait 10 minutes after sending)
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "staff2@mini.vn",
  "code": "123456",
  "newPassword": "NewPassword123!"
}

### Test: Invalid email format
POST {{baseUrl}}/auth/forgot-password
Content-Type: application/json

{
  "email": "invalid-email"
}

### Test: Non-existent email (still returns success for security)
POST {{baseUrl}}/auth/forgot-password
Content-Type: application/json

{
  "email": "nonexistent@example.com"
}

### Test: Weak password
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "staff2@mini.vn",
  "code": "123456",
  "newPassword": "123"
}

### Test: Resend too quickly (within 1 minute)
POST {{baseUrl}}/auth/resend-verification-code
Content-Type: application/json

{
  "email": "staff2@mini.vn"
}

### Test: Too many attempts (try 6 times with wrong code)
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "staff2@mini.vn",
  "code": "000000",
  "newPassword": "NewPassword123!"
}

### ==================== COMPLETE FLOW TEST ====================

### Step 1: Request password reset
POST {{baseUrl}}/auth/forgot-password
Content-Type: application/json

{
  "email": "customer@test.com"
}

### Step 2: Check email and copy the 6-digit code

### Step 3: Verify code and reset password
POST {{baseUrl}}/auth/verify-reset-code
Content-Type: application/json

{
  "email": "customer@test.com",
  "code": "PASTE_CODE_HERE",
  "newPassword": "MyNewSecurePassword123!"
}

### Step 4: Login with new password
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "username": "customer_username",
  "password": "MyNewSecurePassword123!"
}

### ==================== EMAIL SERVICE STATUS CHECK ====================

### Note: To check if email service is configured correctly,
### look at server logs when starting the server.
### You should see: "✅ Email server is ready to send messages"
### If you see error, check .env EMAIL_* variables
