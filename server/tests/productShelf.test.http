### ProductShelf API Tests
### Base URL
@baseUrl = http://localhost:5000/api/product-shelves

###############################################
# 1. GET ALL PRODUCT-SHELF MAPPINGS
###############################################

### Get all product-shelf mappings (with pagination)
GET {{baseUrl}}?page=1&limit=10

### Get all mappings for a specific product
@productId = 6756c1e64f4b5f4d9c8e2a31
GET {{baseUrl}}?product_id={{productId}}

### Get all products on a specific shelf
@shelfId = 6756c1e64f4b5f4d9c8e2a41
GET {{baseUrl}}?shelf_id={{shelfId}}

### Get mappings with both product and shelf filter
GET {{baseUrl}}?product_id={{productId}}&shelf_id={{shelfId}}

###############################################
# 2. GET PRODUCT-SHELF STATS
###############################################

### Get product-shelf statistics
GET {{baseUrl}}/stats

###############################################
# 3. GET ALL SHELVES FOR A PRODUCT
###############################################

### Get all shelves containing a specific product (Gạo ST25)
@gaoST25Id = 6756c1e64f4b5f4d9c8e2a31
GET {{baseUrl}}/product/{{gaoST25Id}}/shelves

### Get shelves for another product (Sữa tươi Vinamilk)
@suaTuoiId = 6756c1e64f4b5f4d9c8e2a33
GET {{baseUrl}}/product/{{suaTuoiId}}/shelves

###############################################
# 4. GET ALL PRODUCTS ON A SHELF
###############################################

### Get all products on shelf A1 (Lương thực)
@shelfA1Id = 6756c1e64f4b5f4d9c8e2a41
GET {{baseUrl}}/shelf/{{shelfA1Id}}/products

### Get all products on shelf B1 (Sữa & Trứng)
@shelfB1Id = 6756c1e64f4b5f4d9c8e2a43
GET {{baseUrl}}/shelf/{{shelfB1Id}}/products

###############################################
# 5. GET PRODUCT-SHELF BY ID
###############################################

### Get product-shelf mapping by ID
@productShelfId = 6756c1e64f4b5f4d9c8e2a51
GET {{baseUrl}}/{{productShelfId}}

###############################################
# 6. CREATE PRODUCT-SHELF MAPPING
###############################################

### Assign product to shelf - Success case
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": 50
}

### Assign product to shelf - Duplicate (should fail or merge)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": 30
}

### Assign product to shelf - Invalid product_id (should fail)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "507f1f77bcf86cd799439011",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": 50
}

### Assign product to shelf - Invalid shelf_id (should fail)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31",
  "shelf_id": "507f1f77bcf86cd799439011",
  "quantity": 50
}

### Assign product to shelf - Missing required fields (should fail)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31"
}

###############################################
# 7. UPDATE PRODUCT-SHELF MAPPING
###############################################

### Update quantity
PUT {{baseUrl}}/{{productShelfId}}
Content-Type: application/json

{
  "quantity": 100
}

### Update both product and shelf (change location)
PUT {{baseUrl}}/{{productShelfId}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a32",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a42",
  "quantity": 75
}

###############################################
# 8. MOVE PRODUCT TO ANOTHER SHELF
###############################################

### Move product from current shelf to new shelf
PUT {{baseUrl}}/{{productShelfId}}/move
Content-Type: application/json

{
  "new_shelf_id": "6756c1e64f4b5f4d9c8e2a42",
  "quantity": 30
}

### Move all quantity to new shelf
PUT {{baseUrl}}/{{productShelfId}}/move
Content-Type: application/json

{
  "new_shelf_id": "6756c1e64f4b5f4d9c8e2a42"
}

### Move to same shelf (should fail or merge)
PUT {{baseUrl}}/{{productShelfId}}/move
Content-Type: application/json

{
  "new_shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": 20
}

###############################################
# 9. BULK ASSIGN PRODUCTS TO SHELF
###############################################

### Assign multiple products to a shelf at once
POST {{baseUrl}}/bulk/assign
Content-Type: application/json

{
  "shelf_id": "6756c1e64f4b5f4d9c8e2a42",
  "products": [
    {
      "product_id": "6756c1e64f4b5f4d9c8e2a31",
      "quantity": 50
    },
    {
      "product_id": "6756c1e64f4b5f4d9c8e2a32",
      "quantity": 30
    },
    {
      "product_id": "6756c1e64f4b5f4d9c8e2a33",
      "quantity": 40
    }
  ]
}

### Bulk assign with some invalid products (partial success)
POST {{baseUrl}}/bulk/assign
Content-Type: application/json

{
  "shelf_id": "6756c1e64f4b5f4d9c8e2a42",
  "products": [
    {
      "product_id": "6756c1e64f4b5f4d9c8e2a31",
      "quantity": 50
    },
    {
      "product_id": "507f1f77bcf86cd799439011",
      "quantity": 30
    }
  ]
}

### Bulk assign - Missing shelf_id (should fail)
POST {{baseUrl}}/bulk/assign
Content-Type: application/json

{
  "products": [
    {
      "product_id": "6756c1e64f4b5f4d9c8e2a31",
      "quantity": 50
    }
  ]
}

###############################################
# 10. DELETE PRODUCT-SHELF MAPPING
###############################################

### Remove product from shelf (soft delete)
@deleteProductShelfId = 6756c1e64f4b5f4d9c8e2a51
DELETE {{baseUrl}}/{{deleteProductShelfId}}

###############################################
# INTEGRATION TESTS
###############################################

### Integration: Assign -> Get -> Update -> Move -> Delete
### Step 1: Assign product to shelf
# POST {{baseUrl}}
# Content-Type: application/json
# {
#   "product_id": "6756c1e64f4b5f4d9c8e2a31",
#   "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
#   "quantity": 100
# }

### Step 2: Get by ID (use ID from create response)
# GET {{baseUrl}}/NEW_MAPPING_ID_HERE

### Step 3: Update quantity
# PUT {{baseUrl}}/NEW_MAPPING_ID_HERE
# Content-Type: application/json
# {
#   "quantity": 150
# }

### Step 4: Move to another shelf
# PUT {{baseUrl}}/NEW_MAPPING_ID_HERE/move
# Content-Type: application/json
# {
#   "new_shelf_id": "6756c1e64f4b5f4d9c8e2a42",
#   "quantity": 75
# }

### Step 5: Get all products on new shelf
# GET {{baseUrl}}/shelf/6756c1e64f4b5f4d9c8e2a42/products

### Step 6: Delete mapping
# DELETE {{baseUrl}}/NEW_MAPPING_ID_HERE

###############################################
# BUSINESS LOGIC TESTS
###############################################

### Test: Product on multiple shelves (should be allowed)
# 1. Assign product A to shelf 1
# 2. Assign same product A to shelf 2
# 3. Get all shelves for product A (should return 2 shelves)

### Test: Shelf with multiple products (should be allowed)
# 1. Assign product A to shelf 1
# 2. Assign product B to shelf 1
# 3. Get all products on shelf 1 (should return 2 products)

### Test: Move product between shelves
# 1. Assign product to shelf A with quantity 100
# 2. Move 30 units to shelf B
# 3. Check shelf A quantity (should be 70)
# 4. Check shelf B quantity (should be 30)

###############################################
# EDGE CASES & VALIDATION TESTS
###############################################

### Invalid mapping ID format
GET {{baseUrl}}/invalid-id-format

### Non-existent mapping ID
GET {{baseUrl}}/507f1f77bcf86cd799439011

### Zero quantity (should fail if validation exists)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": 0
}

### Negative quantity (should fail)
POST {{baseUrl}}
Content-Type: application/json

{
  "product_id": "6756c1e64f4b5f4d9c8e2a31",
  "shelf_id": "6756c1e64f4b5f4d9c8e2a41",
  "quantity": -50
}

### Move more quantity than available (should fail)
PUT {{baseUrl}}/{{productShelfId}}/move
Content-Type: application/json

{
  "new_shelf_id": "6756c1e64f4b5f4d9c8e2a42",
  "quantity": 99999
}

###############################################
# NOTES
###############################################
# Replace @productShelfId, @productId, @shelfId with actual IDs from your database
# Sample IDs from seed.js (adjust as needed):
# - Gạo ST25: Check database for actual Product ObjectId
# - Shelf A1: Check database for actual Shelf ObjectId
# - ProductShelf mappings: Check database for actual ProductShelf ObjectIds
